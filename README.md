# server_emulator

## Compile and run

### Do once

Create file "scripts/settings.lua" with the following content

```
local settings =
{
    path = <full_path_to_plugin>
}

return settings
```

### Run

`cargo run --bin server_emulator --features lua_server`

Note: make sure scripts directory is in current working directory

## (Re)generate bindings (not needed)

`bindgen --vtable-generation .\headers\MT5APIServer.hpp -o MT5APIServer.rs`

Note: autogenerated result is not production ready

You have to do:
1. Rearrange functions in vtables from
`
fn foo(args);
fn foo1(args1);
`

to

`
fn foo1(args1);
fn foo(args);
`

For some reason msvc decides to arrange overloaded calls in such way and clang (used by bindgen) in other

2. Implement sinks

bindgen does not generate vtables for classes with default implementation

## Dependencies

[libloading](https://github.com/nagisa/rust_libloading)

[mlua](https://github.com/mlua-rs/mlua)
